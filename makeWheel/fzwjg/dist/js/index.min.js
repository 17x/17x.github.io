var myApp=angular.module("myApp",["ngAnimate","ui.router","ngTouch","ngCookies","angular-carousel","ngDialog","angularFileUpload"]);myApp.run(["$templateCache",function(t){t.put("templateId1","tpls/search.html"),t.put("templateId2","tpls/category.html"),t.put("templateId3","tpls/usercenter.html"),t.put("templateId4","tpls/post.html"),t.put("templateId5","tpls/city.html"),t.put("templateId6","tpls/info.html"),t.put("templateId7","tpls/login.html"),t.put("templateId8","tpls/reg.html"),t.put("templateId9","tpls/mypost.html"),t.put("templateId10","tpls/report.html")}]),window.onresize=function(){return document.getElementsByTagName("html")[0].style.fontSize=(document.documentElement||document.body).clientWidth/25+"px",arguments.callee}();
myApp.controller("myAppCtrl",["$rootScope","$scope","$swipe","$location","$document","$animate","$timeout","$cookies","$interval","ngDialog","$http",function(e,o,t,n,i,a,c,l,s,r,g){console.log("*** 开始加载全局CTRL ***"),console.log("*** 绑定到$rootScope上的方法： ngDialog $timeout $location $http $cookies ***"),e.$timeout=c,e.$location=n,e.$http=g,e.$cookies=l,e.ngDialog=r,console.log("*** 运行简单的百度广告去除 ***"),function(){var o=(new BMap.Map("baidumap"),{}),t=new BMap.Geolocation;t.getCurrentPosition(function(t){this.getStatus()==BMAP_STATUS_SUCCESS?o=t.point:alert("failed"+this.getStatus());var n=new BMap.Geocoder;n.getLocation(o,function(o){var t=o.addressComponents;console.log(t.city),e.$http.get("mock/cities/cities.json").then(function(o){var n=o.data.cities;console.log(n);for(var i in n)if("object"==typeof n[i])for(var a in n[i])n[i][a].cityname===t.city.replace("市","")&&(e.setCity({cityname:t.city.replace("市",""),cityid:n[i][a].cityid}),e.loadInfoList());e.ngDialog.open({template:"<p>定位于"+t.city+"，自动切换至"+t.city.replace("市","")+"站</p>",plain:!0,className:"ngdialog-theme-default",overlay:!1,showClose:!1,width:"auto"}),e.$timeout(function(){e.ngDialog.closeAll()},2e3)},function(){})})},{enableHighAccuracy:!0})}();var u=[],m=["baidu","winyylg"];s(function(){u=document.all;for(var e=0;e<u.length;e++){var o=u[e],t=1===o.nodeType?o.tagName.toLowerCase():"noTag";if("aimgscriptiframe".indexOf(t)!==-1)try{m.indexOf(o.href)!==-1&&o.parentNode.removeChild(o)}catch(e){m.indexOf(o.crc)!==-1&&o.parentNode.removeChild(o)}}},2e3),e.$cookies.getObject("userInfo")&&(console.log("*** 进入页面时检测到cookie存在userInfo ***",e.$cookies.getObject("userInfo")),e.isLogIn=!0),void 0!==typeof Storage&&window.localStorage.getItem("cityid")&&void 0!==window.localStorage.getItem("cityname")?e.currentCity={cityid:window.localStorage.getItem("cityid"),cityname:window.localStorage.getItem("cityname")}:(console.log("*** 不支持localstorage或其内没有找到城市信息 ***"),e.$cookies.getObject("cityInfo")?(e.currentCity={cityname:l.get("cityname"),cityid:l.get("curCity")},console.log("*** 进入页面时检测到cookie存在cityInfo ***",e.$cookies.getObject("cityInfo"))):(console.log("*** 城市设置为总站 ***"),e.currentCity={cityid:"00",cityname:"总站"})),e.loadInfoList=function(){g.get("mock/cities/city"+Number(e.currentCity.cityid)+"/cityinfo.json").then(function(o){e.cityInfoOnHome=o.data},function(e){console.log(e)})},e.loadInfoList(),o.isShowCity={value:!1},o.showCity=function(){o.isShowCity={value:!0}},e.setCity=function(t){console.log(t),e.currentCity={cityname:t.cityname,cityid:t.cityid};var n=new Date;n.setDate(n.getDate()+1),e.$cookies.putObject("cityInfo",{cityid:t.cityid,cityname:t.cityname},{expires:n}),window.localStorage.setItem("cityname",t.cityname),window.localStorage.setItem("cityid",t.cityid),o.isShowCity={value:!1},e.loadInfoList(),e.$location.url("/home")},o.timer=null,o.splashTimer=null;var d=i.find("body"),p=["home","category","usercenter","post"];o.$on("$stateChangeStart",function(t,n,i,a,l){var s=["index.home","index.category","index.usercenter","index.post"];console.group(),console.log("*** 路由change开始 ***"),console.log("*** 本次路由change参数:","\n event:",t,"\n toState:",n,"\n toParams:",i,"\n fromState:",a,"\n fromParams:",l," ***"),console.groupEnd(),e.isLogIn&&n.url.indexOf("login")!==-1&&(console.log("请求前往login页面"),console.log("检测到已经登录,跳转至usercenter"),console.log("login位于toState.url的位置:",n.url.indexOf("login")),e.$location.url("/usercenter")),c.cancel(o.timer),""!==a.name&&(d.removeClass("fadeOutAndIn"),d.removeClass("fadeInAndOutToRight"),s.indexOf(a.name)>s.indexOf(n.name)?d.addClass("fadeInAndOutToRight"):s.indexOf(a.name)<s.indexOf(n.name)?d.addClass("fadeOutAndIn"):d.addClass("fadeOutAndIn"),o.timer=c(function(){d.removeClass("fadeOutAndIn"),d.removeClass("fadeInAndOutToRight")},500)),"home"===n.name?c(function(){e.isShowBack=!1},500):e.isShowBack=!0}),o.$on("$stateChangeSuccess",function(t,i,a,l,s){console.log("路由change完成，toState:",i,"$location.url():",n.url()),i.name.indexOf("login")===-1&&(e.lastState=n.url()),c.cancel(o.splashTimer),o.splashTimer=c(function(){document.getElementById("splash").style.display="none"},1e3)}),e.setHeader=function(o,t){switch(o){case"home":t={title:"服装微加工",icon:"icon-wjg-tb"};break;case"category":t={title:"分类",icon:"icon-iconfenlei"};break;case"usercenter":t={title:"用户中心",icon:"icon-icon iconfont icon-gerenzhongxin"};break;case"city":t={title:"选择城市",icon:"icon-wjg-dt"};break;case"post":t={title:"发布信息",icon:"icon-icon-fabu"};break;case"search":t={title:"搜索",icon:"icon-sousuo"};break;case"custom":t=t}c(function(){e.headerTitle=t},200)},o.handleSwipeLeft=function(){console.log("$location.path():",n.path());var e=p.indexOf(n.path().replace("/",""));return e!==-1&&void(3!==e?n.path(p[e+1]):n.path(p[0]))},o.handleSwipeRight=function(){var e=p.indexOf(n.path().replace("/",""));return e!==-1&&void(0!==e?n.path(p[e-1]):n.path(p[p.length-1]))},o.footerItems=[{itemName:"首页",srefLink:"home",iconName:"icon-shouye"},{itemName:"分类",srefLink:"category",iconName:"icon-iconfenlei"},{itemName:"用户中心",srefLink:"usercenter",iconName:"icon-gerenzhongxin"},{itemName:"发布",srefLink:"post",iconName:"icon-fabu"}],e.$http.get("mock/cates.json").then(function(o){e.cates=o.data},function(e){})}]),myApp.controller("homeCtrl",["$rootScope","$scope","updateHomeItem",function(e,o,t){e.setHeader("home"),e.$location.url("home"),e.isShowBack=!1,void 0!==typeof Storage&&window.localStorage.aCategorysInHome&&(console.log("进入页面后找寻本地存储进行赋值"),o.aCategorysInHome=JSON.parse(window.localStorage.aCategorysInHome),console.log(o.aCategorysInHome)),t.getNewest().then(function(e){e&&(o.aCategorysInHome=e.data)},function(e){console.log("获取错误")})}]),myApp.controller("searchCtrl",["$rootScope","$scope","searchService",function(e,o,t){e.setHeader("search"),e.$location.search().keywords&&e.$location.search().keywords.length&&(e.searchInput=e.$location.search().keywords),e.$location.search().catid&&e.$location.search().catid.length,e.ngDialog.open({template:"<p>本地没有对应分类信息</p><p>跳转至总分类</p>",plain:!0,className:"ngdialog-theme-default",overlay:!1,showClose:!1,width:"auto"}),e.$timeout(function(){e.ngDialog.closeAll()},2e3),o.isShowFilter=!0,o.catid=0,e.$location.search("catid","0");var n=0;t(n).then(function(e){o.searchData=e.data},function(){}),o.searchMore=function(){return++n,9===n?(n=8,console.log("mo more info "),!1):void t(n).then(function(e){o.searchData=o.searchData.concat(e.data)},function(){})}}]),myApp.controller("categoryCtrl",["$rootScope","$scope",function(e,o){e.setHeader("category")}]),myApp.controller("usercenterCtrl",["$rootScope","$scope",function(e,o){e.setHeader("usercenter"),e.isLogIn||(e.ngDialog.open({template:"<p>请先登录！</p>",plain:!0,className:"ngdialog-theme-default",overlay:!1,showClose:!1,width:"auto"}),e.$timeout(function(){e.ngDialog.closeAll()},2e3)),o.logout=function(){console.log(e.$location),e.$cookies.remove("userInfo"),e.isLogIn=!1}}]),myApp.controller("postCtrl",["$rootScope","$scope","FileUploader",function(e,o,t){e.setHeader("post"),e.isLogIn||(e.ngDialog.open({template:"<p>请先登录！</p>",plain:!0,className:"ngdialog-theme-default",overlay:!1,showClose:!1,width:"auto"}),e.$timeout(function(){e.ngDialog.closeAll()},2e3),e.$location.path("/login")),o.uploader=new t({url:"127.0.0.1",autoUpload:!0,queueLimit:10}),o.isImage=function(e){var o="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(o)!==-1},o.postSubmit=function(){console.log(o.uploader),e.ngDialog.open({template:"<p>发布没成功，因为没有对接后台。</p><p>3秒后跳转至用户中心</p>",plain:!0,className:"ngdialog-theme-default",overlay:!1,showClose:!1,width:"auto"}),e.$timeout(function(){e.ngDialog.closeAll(),e.$location.url("/usercenter")},2e3)},o.isShowPostCate={value:!1},o.isShowPostCity={value:!1,fromPage:"post"},o.cates=e.cates,e.postInfo=o.postInfo={areaid:"",areaname:"",cityid:"",cityname:"",cate:"",cateid:"",expiretime:"",contact:"",cel:"",qq:"",title:"",content:""}}]),myApp.controller("infoCtrl",["$rootScope","$scope",function(e,o){o.curInfo=e.curInfo,e.curInfo=null;var t=0;o.curInfo?t=o.curInfo.id:!o.curInfo&&e.$location.search().infoid&&(t=e.$location.search().infoid),(e.$location.search().infoid<53864||e.$location.search().infoid>53914)&&(e.isLogIn||(e.ngDialog.open({template:"<p>假数据不存在，随机重定向</p>",plain:!0,className:"ngdialog-theme-default",overlay:!1,showClose:!1,width:"auto"}),e.$timeout(function(){e.ngDialog.closeAll()},2e3)),console.log(t,"num is not in range"),t=parseInt(49*Math.random())+53864,console.log("随机分配infoid:",t)),e.$location.search("infoid",t),e.$http.get("mock/infos/"+t+".json").then(function(t){o.curInfo=t.data;var n="icon";switch(o.curInfo.parentid){case 246:n="icon-waifajiagong";break;case 264:n="icon-chengjiejiagong";break;case 299:n="icon-shebeizurangweixiu";break;case 309:n="icon-chengpinkucun";break;case 323:n="icon-changfangzurang";break;case 327:n="icon-mianfuliaogongqiu";break;case 338:n="icon-zhaopin";break;case 367:n="icon-qiuzhi";break;default:n="icon-wjg-tb"}e.setHeader("custom",{title:t.data.title,icon:n})},function(e){});var n=[["mock/img/pre_1484540313t64on.jpg","mock/img/pre_1484540343znkl1.JPEG","mock/img/pre_1484540364ineji.jpg","mock/img/pre_14845404071dgw4.jpg"],["mock/img/1484540313t64on.jpg","mock/img/1484540343znkl1.JPEG","mock/img/1484540364ineji.jpg","mock/img/14845404071dgw4.jpg"]];o.slides=n[0],o.tapImage=function(e){var t=document.getElementById("imgCarouselCover");angular.element(t).hasClass("fullscreen")?(angular.element(t).removeClass("fullscreen"),o.slides=n[0]):(angular.element(t).addClass("fullscreen"),o.slides=n[1])}}]),myApp.controller("loginCtrl",["$rootScope","$scope",function(e,o){e.setHeader("custom",{title:"登录",icon:"icon-icon iconfont icon-gerenzhongxin"}),o.username="testUserName",o.password="testPassword",o.login=function(){if("testUserName"===o.username&&"testPassword"===o.password){e.isLogIn=!0;var t=new Date;t.setDate(t.getDate()+1),e.$cookies.putObject("userInfo",{isLogIn:!0,username:o.username,userpwd:o.password},{expires:t}),console.log(e.lastState),e.lastState?e.$location.url(e.lastState):e.$location.url("/usercenter")}}}]),myApp.controller("reportCtrl",["$rootScope","$scope",function(e,o){e.setHeader("custom",{title:"举报",icon:"icon-wjg-tb"}),e.isLogIn||e.$location.url("/login"),o.text="hello world!!"}]),myApp.controller("regCtrl",["$rootScope","$scope",function(e,o){}]);
myApp.directive("city",["$rootScope","$anchorScroll",function(t,i){return{restrict:"AE",scope:{isshowcity:"=",postinfo:"=",setcity:"&"},templateUrl:"tpls/city.html",controller:["$scope","$rootScope",function(t,e){if(this.isshowcity=t.isshowcity,this.city=t.city=e.currentCity,this.postinfo=t.postinfo,t.isshowarea=!1,console.log("开启地区选择面板"),"post"===t.isshowcity.fromPage)if(console.log("从post开启city指令"),"00"===e.currentCity.cityid){console.log("当前city为总站"),e.$http.get("mock/cities/cities.json").then(function(i){t.cities=i.data},function(t){});var o=this;t.setcity=function(i){return"00"!==i.cityid&&(console.log("选择了一个city：",i),o.city=t.city=i,console.log("此时的city：",t.city),void(t.isshowarea=!0))}}else t.isshowarea=!0;else e.$http.get("mock/cities/cities.json").then(function(i){t.cities=i.data},function(t){}),t.setcity=e.setCity;t.scrollTo=function(t){i.yOffset=44,i("province"+t)}}]}}]),myApp.directive("postarea",["$rootScope",function(t){return{restrict:"AE",scope:{},require:"^city",template:'<div class="cities area">请选择<span ng-bind="city.cityname"></span>下的区：scope<ul><li ng-repeat="area in areas"><a ng-click=setArea(area)>{{area.areaname}}</a></li></ul></div>',link:function(i,e,o,c){i.city=c.city,console.log("加载了postarea"),console.log("此时的post city",i.city),console.log(c),"105"!==i.city.cityid&&"206"!==i.city.cityid||(alert("105 唐山 206 大连两个城市没有数据"),c.postinfo.cityid=i.city.cityid,c.postinfo.cityname=i.city.cityname,c.postinfo.areaname=i.city.cityname,c.isshowcity.value=!1),t.$http.get("mock/cities/city"+Number(i.city.cityid)+"/allarea.json").then(function(t){i.areas=t.data.areas,console.log(t.data.areas)},function(t){}),i.setArea=function(t){console.log(t),console.log(c.isshowcity),console.log("选择了一个area，关闭city选择面板"),c.postinfo.cityid=i.city.cityid,c.postinfo.cityname=i.city.cityname,c.postinfo.areaid=t.areaid,c.postinfo.areaname=t.areaname,console.log(c.postinfo),c.isshowcity.value=!1}}}}]),myApp.directive("searchBar",["$rootScope",function(t){return{restrict:"AE",require:"?search",replace:!0,templateUrl:"tpls/searchbar.html",link:function(i,e,o,c){t.searchInput=""}}}]),myApp.directive("infolist",["$http","$q","$rootScope",function(t,i,e){return{restrict:"AE",replace:!1,scope:{cityinfoonhome:"="},templateUrl:"tpls/infolistonhome.html",link:function(t){console.log(t.cityInfoOnHome)}}}]),myApp.directive("ngThumb",["$window",function(t){var i={support:!(!t.FileReader||!t.CanvasRenderingContext2D),isFile:function(i){return angular.isObject(i)&&i instanceof t.File},isImage:function(t){var i="|"+t.type.slice(t.type.lastIndexOf("/")+1)+"|";return"|jpg|png|jpeg|bmp|gif|".indexOf(i)!==-1}};return{restrict:"A",template:"<canvas/>",link:function(t,e,o){function c(t){var i=new Image;i.onload=n,i.src=t.target.result}function n(){var t=s.width||this.width/this.height*s.height,i=s.height||this.height/this.width*s.width;a.attr({width:t,height:i}),a[0].getContext("2d").drawImage(this,0,0,t,i)}if(i.support){var s=t.$eval(o.ngThumb);if(i.isFile(s.file)&&i.isImage(s.file)){var a=e.find("canvas"),r=new FileReader;r.onload=c,r.readAsDataURL(s.file)}}}}}]),myApp.directive("catechoose",function(){return{restrict:"AE",replace:!0,scope:{postinfo:"=",closehandle:"="},transclude:!0,template:"<div ng-transclude></div>",controller:["$scope",function(t){console.log("*** 打开post页面的分类选择面板指令","*** "),console.log("*** 此时表单信息为",t.postinfo,"***");var i=[],e=[],o=0;this.addPane=function(t){t.isShowChildren=!1,i.push(t)},this.addDom=function(t){e.push(t),o=e[0][0].offsetHeight-2},this.switchPane=function(t){var c=i.indexOf(t);console.log("处理开始：下标为",c,t.isShowChildren),angular.forEach(i,function(i,n,s){n!==c||t.isShowChildren===!0?(i.isShowChildren=!1,e[n][0].style.height=o+"px"):(t.isShowChildren=!0,e[c][0].style.height=e[c].find("ul")[0].offsetHeight+o+"px")})},this.setCate=function(i){console.log("点击了一个分类",i),t.postinfo.cate=i.catname,t.postinfo.catid=i.catid,console.log("*** 此时表单信息为",t.postinfo,"***"),console.log("*** 关闭分类选择面板指令 ***"),t.closehandle.value=!1}}]}}),myApp.directive("catechoosepane",["$rootScope",function(t){return{restrict:"AE",replace:!0,transclude:!0,require:"^catechoose",scope:{cate:"="},link:function(t,i,e,o){o.addPane(t),o.addDom(i),t.switchPane=o.switchPane,t.setCate=o.setCate},template:'<div class="cates"><div class="catesHead" ng-click="switchPane(this)"><h1>{{cate.catname}}</h1><p>{{pane.isShowChildren}}</p></div><ul><li ng-repeat="a in cate.children"><a ng-click="setCate(a)">{{a.catname}}</a></li></ul></div>'}}]);
myApp.config(["$stateProvider","$urlRouterProvider","$locationProvider",function(t,e,l){l.html5Mode(!1),e.otherwise("/home"),t.state("index",{abstract:!0,views:{"header@index":{templateUrl:"tpls/header.html"},"footer@index":{templateUrl:"tpls/footer.html"},"content@index":{templateUrl:"tpls/main.html"}}}).state("index.home",{url:"/home","content@index":{templateUrl:"tpls/main.html"}}).state("index.search",{url:"/search?:keywords:catid",views:{"content@index":{controller:"searchCtrl",templateUrl:"tpls/search.html"}}}).state("index.category",{url:"/category",views:{"content@index":{controller:"categoryCtrl",templateUrl:"tpls/category.html"}}}).state("index.usercenter",{url:"/usercenter",views:{"content@index":{controller:"usercenterCtrl",templateUrl:"tpls/usercenter.html"}}}).state("index.post",{url:"/post",views:{"content@index":{controller:"postCtrl",templateUrl:"tpls/post.html"}}}).state("index.info",{url:"/info?infoid",views:{"content@index":{controller:"infoCtrl",templateUrl:"tpls/info.html"}}}).state("index.login",{url:"/login",views:{"content@index":{controller:"loginCtrl",templateUrl:"tpls/login.html"}}}).state("index.register",{url:"/register",views:{"content@index":{controller:"regCtrl",templateUrl:"tpls/reg.html"}}}).state("index.report",{url:"/report?infoid",views:{"content@index":{controller:"reportCtrl",templateUrl:"tpls/report.html"}}}).state("index.mypost",{url:"/mypost",views:{"content@index":{templateUrl:"tpls/mypost.html"}}}).state("index.myfavor",{url:"/mypost",views:{"content@index":{templateUrl:"tpls/myfavor.html"}}}).state("index.history",{url:"/history",views:{"content@index":{templateUrl:"tpls/history.html"}}}).state("index.usersetting",{url:"/usersetting",views:{"content@index":{templateUrl:"tpls/usersetting.html"}}}).state("index.contactus",{url:"/contactus",views:{"content@index":{templateUrl:"tpls/contactus.html"}}}).state("index.feedback",{url:"/feedback",views:{"content@index":{templateUrl:"tpls/feedback.html"}}})}]);
myApp.service("updateHomeItem",["$http","$q",function(e,r){this.getNewest=function(){var t=r.defer();return e({method:"get",url:"mock/aCategorysInHome.json"}).then(function(e){t.resolve(e)},function(e){t.reject("error")}),t.promise}}]),myApp.service("searchService",["$http","$q",function(e,r){return function(t){var n=r.defer();return e.get("mock/search/cate"+t+".json").then(function(e){n.resolve(e)},function(){n.reject("error")}),n.promise}}]);
//# sourceMappingURL=index.min.js.map
